if(function(){"use strict";var a=function(){this.datastore=null,this.results=[],this.selectedIndex=0,this.target=null,this.dom=null,this.container=null,this.reader=null,this.lastValue="",this.resultsVisible=!1,this.eventsReady=!1,this.ready=!1;var a=this,d={},e=[];this.attach=function(a){return this.target?void console.log("[Quickspot] This quickspot instance has already attached."):void("complete"===document.readyState||a.safeload===!1?d.attach(a):c.addListener(window,"load",function(){d.attach(a)}))},this.setDatastore=function(b){if("undefined"!=typeof b.store){if(null===b.store)return void(b.__loaded=function(b){a.setDatastore(b)});b=b.store}return this.datastore=b,this.eventsReady&&c.triggerEvent(this.target,"quickspot:loaded",this),"undefined"!=typeof this.options.loaded&&this.options.loaded(this.datastore),this.ready&&this.refresh(),this},this.showAll=function(b,c,e){return this.target.value="",this.lastValue="","undefined"!=typeof e&&e||this.target.focus(),a.results=a.datastore.all(b,c).get(),d.render_results(a.results),d.showResults(),this},this.on=function(b,d){return a.eventsReady?c.addListener(a.target,b,d):e.push({event:b,callback:d}),this},this.showResults=function(){return d.showResults(),this},this.hideResults=function(){return d.hideResults(),this},this.refresh=function(){return d.refresh(),this},this.filter=function(a,b){return this.datastore.filter(a,b),this},this.clearFilters=function(){return this.datastore.clear_filters(),this},d.attach=function(b){for(var e in b)a.options[e]=b[e];if(!b.target)return void console.log("[Quickspot] Target not specified");if(a.target=d.get_option_contents_as_node(a.options.target,!1),!a.target)return void console.log("[Quickspot] Target ID could not be found");if(a.eventsReady=!0,d.attachQueuedEvents(),"undefined"==typeof a.options.display_name&&(a.options.display_name=a.options.key_value),a.on("quickspot:init",d.init),"undefined"!=typeof a.options.url)c.ajaxGetJSON(a.options,d.initialise_data);else{if("undefined"==typeof a.options.data)return void console.log("[Quickspot] No datasource provided.");d.initialise_data(b.data)}},d.init=function(){if(a.dom=document.createElement("div"),a.dom.className=a.options.css_class_prefix+"-results","undefined"==typeof a.options.results_container?(a.container=document.createElement("div"),a.target.parentNode.appendChild(a.container)):a.container=d.get_option_contents_as_node(a.options.results_container,!1),a.container.setAttribute("tabindex","100"),a.container.style.display="none",a.container.className=a.container.className+" "+a.options.css_class_prefix+"-results-container",a.container.setAttribute("aria-hidden","true"),"undefined"!=typeof a.options.results_header){var b=d.get_option_contents_as_node(a.options.results_header,!0);b&&a.container.appendChild(b)}if(a.container.appendChild(a.dom),"undefined"!=typeof a.options.results_footer){var e=d.get_option_contents_as_node(a.options.results_footer,!0);e&&a.container.appendChild(e)}c.addListener(a.target,"keydown",d.handleKeyUp),c.addListener(a.target,"keyup",d.handleKeyDown),c.addListener(a.target,"focus",d.handleFocus),c.addListener(a.target,"blur",d.handleBlur),c.addListener(a.container,"blur",d.handleBlur),c.addListener(a.container,"blur",d.handleKeyUp),a.reader=d.screenreaderHelper(),"function"==typeof a.options.ready&&a.options.ready(a),c.triggerEvent(a.target,"quickspot:ready",a),a.ready=!0,a.target.quickspot=a},d.attachQueuedEvents=function(){var b;for(b in e)a.on(e[b].event,e[b].callback);if(e=null,"object"==typeof a.options.events)for(b in a.options.events)a.on(b,a.options.events[b])},d.get_option_contents_as_node=function(b,c){var d;if(b="function"==typeof b?b(a):b,"object"==typeof b&&b.nodeType&&1===b.nodeType)return b;if("string"==typeof b){if(b.indexOf(" ")===-1&&(d=1===b.indexOf("#")?document.getElementById(b.substring(1)):document.getElementById(b),null!==d))return d;if("undefined"!=typeof c&&c)return d=document.createElement("div"),d.innerHTML=b,d}return!1},d.screenreaderHelper=function(){var b,e,f=document.createElement("div");return f.setAttribute("aria-live","assertive"),f.setAttribute("aria-relevant","additions"),f.className="screenreader",f.setAttribute("style","position: absolute!important; clip: rect(1px 1px 1px 1px); clip: rect(1px,1px,1px,1px);"),a.target.parentNode.appendChild(f),c.addListener(a.target,"quickspot:end",function(){e&&clearTimeout(e),e=setTimeout(function(){0===a.results.length?d.screenReaderAnnounce("No suggestions found. Hit enter to search."):(b=a.options.screenreader_result_text(a.results[a.selectedIndex],a.selectedIndex,a),d.screenReaderAnnounce(a.results.length+" suggestions. "+b))},400)}),c.addListener(a.target,"quickspot:select",function(){b=a.options.screenreader_result_text(a.results[a.selectedIndex],a.selectedIndex,a),d.screenReaderAnnounce(b)}),c.addListener(a.target,"quickspot:activate",function(){d.screenReaderAnnounce("Loading...")}),f},d.getScreenReaderResultText=function(b,d){return b&&"string"==typeof b.qs_screenreader_text?d+1+". "+b.qs_screenreader_text:d+1+". Go to "+c.extractValue(b,a.options.display_name)+"?"},d.refresh=function(){c.triggerEvent(a.target,"quickspot:start",a),a.selectedIndex=0,a.results=a.datastore.search(a.lastValue).get(),d.render_results(a.results),c.triggerEvent(a.target,"quickspot:end",a),c.triggerEvent(a.target,"quickspot:result",a)},d.findResultsFor=function(b){return""===b?("function"==typeof a.options.no_search_handler&&a.options.no_search_handler(a.dom,a),void(a.options.show_all_on_blank_search?a.showAll():(a.results=[],d.hideResults()))):a.lastValue===b?(d.showResults(),void c.triggerEvent(a.target,"quickspot:result",a)):(a.lastValue=b,d.refresh(),void a.showResults())},d.handleFocus=function(b){a.resultsVisible||d.findResultsFor(a.target.value)},d.handleKeyDown=function(b){var e=b.keyCode;return 13===e||38===e||40===e?c.preventDefault(b):void d.findResultsFor(a.target.value)},d.handleKeyUp=function(b){var e=b.keyCode;13===e&&d.handleSelection(a.results[a.selectedIndex]),38===e&&0!==a.results.length&&(d.selectIndex(a.selectedIndex-1),d.scrollResults("up"),c.triggerEvent(a.target,"quickspot:select",a)),40===e&&0!==a.results.length&&(d.selectIndex(a.selectedIndex+1),d.scrollResults("down"),c.triggerEvent(a.target,"quickspot:select",a)),13!==e&&38!==e&&40!==e||c.preventDefault(b)},d.handleBlur=function(b){"undefined"!=typeof a.options.hide_on_blur&&a.options.hide_on_blur===!1||setTimeout(function(){a.container!==document.activeElement&&a.target!==document.activeElement&&a.container.contains(document.activeElement)===!1&&d.hideResults()},150)},d.selectIndex=function(b){c.removeClass(a.dom.children[a.selectedIndex],"selected"),b>=a.results.length?a.selectedIndex=a.results.length-1:b<0?a.selectedIndex=0:a.selectedIndex=b,c.addClass(a.dom.children[a.selectedIndex],"selected")},d.scrollResults=function(b){var c=a.dom.clientHeight,d=a.dom.childNodes[a.selectedIndex],e=d.offsetHeight,f=d.offsetTop;"down"===b&&f+e-a.dom.scrollTop>c&&(a.dom.scrollTop=f+e-c),"up"===b&&f<a.dom.scrollTop&&(a.dom.scrollTop=f)},d.render_empty_results=function(){c.triggerEvent(a.target,"quickspot:noresults",a);var b=a.options.no_results(a,a.lastValue);return b===!1?d.hideResults():(a.dom.innerHTML=b,"undefined"!=typeof a.dom.childNodes[0]&&c.addListener(a.dom.childNodes[0],"click",function(a){d.handleSelection()}),d.showResults())},d.render_results=function(b){if("function"==typeof a.options.parse_results&&(b=a.options.parse_results(b,a.options)),0===b.length)return d.render_empty_results();var e,f,g,h=document.createDocumentFragment();"number"==typeof a.options.max_results&&0!==a.options.max_results&&b.length>a.options.max_results&&(b=b.slice(0,a.options.max_results)),b.forEach(function(b,i){f="function"==typeof a.options.display_handler?a.options.display_handler(b,a):c.extractValue(b,a.options.display_name),a.options.auto_highlight===!0&&(f=f.replace(RegExp("("+a.lastValue+")(?![^<]*>|[^<>]*</)","i"),"<strong>$1</strong>")),e=document.createElement("a"),e.innerHTML=f,g=a.options.css_class_prefix+"-result "+a.options.css_class_prefix+"-result-"+i,"string"==typeof b.qs_result_class&&(g=b.qs_result_class+" "+g),e.className=g,c.addListener(e,"click",function(a){d.handleSelection(b)}),c.addListener(e,"mouseover",function(a){d.selectIndex(i)}),h.appendChild(e)}),c.triggerEvent(a.target,"quickspot:resultsfound",a),a.dom.innerHTML="",a.dom.appendChild(h),d.selectIndex(a.selectedIndex)},d.handleSelection=function(b){return"undefined"==typeof b?a.options.no_results_click(a.lastValue,a):(c.triggerEvent(a.target,"quickspot:activate",a),void("undefined"!=typeof a.options.click_handler?a.options.click_handler(b,a):"string"==typeof b.url?window.location.href=b.url:(a.target.value=c.extractValue(b,a.options.display_name),d.hideResults())))},d.no_results=function(b,c){return'<a class="'+a.options.css_class_prefix+'-result selected">No results...</a>'},d.screenReaderAnnounce=function(b){a.reader.innerHTML="<p>"+b+"</p>"},d.initialise_data=function(d){a.setDatastore(b.create(d,a.options)),c.triggerEvent(a.target,"quickspot:init",a)},d.hideResults=function(){c.triggerEvent(a.target,"quickspot:hideresults",a),"function"==typeof a.options.hide_results?a.options.hide_results(a.container,a):a.container.style.display="none",a.resultsVisible=!1},d.showResults=function(){c.triggerEvent(a.target,"quickspot:showresults",a),"function"==typeof a.options.show_results?a.options.show_results(a.container,a):a.container.style.display="block",a.resultsVisible=!0},this.options={key_value:"name",css_class_prefix:"quickspot",auto_highlight:!0,show_all_on_blank_search:!1,no_results:d.no_results,screenreader_result_text:d.getScreenReaderResultText,no_results_click:function(a,b){},error:function(a,b){console.log("[Quickspot] AJAX request failed with error "+a)}}},b=function(a,b){this.data=[],this.data_filtered=[],this.results=[];var d=this,e={};e.create=function(a,b){for(var c in b)d.options[c]=b[c];d.options.key_value||(d.options.key_value="name"),"function"!=typeof d.options.default_sort&&d.options.default_sort!==!1&&(d.options.default_sort=e.default_sort),d.fill(a)},this.empty=function(){return this.data_filtered=this.data=this.results=[],this},this.fill=function(a){if("function"==typeof d.options.data_pre_parse&&(a=d.options.data_pre_parse(a,d.options)),!a instanceof Array){var b,f=[];for(b in a)a.hasOwnProperty(b)&&"object"==typeof a[b]&&null!==a[b]&&f.push(a[b]);a=f}var g="undefined"!=typeof d.options.search_on&&d.options.search_on;for(b=0;b<a.length;b++)a[b]=e.pre_process(a[b],g);return d.data_filtered=d.data=c.shallowCopy(a),d.results=[],this},this.find=function(a,b){return a=d.options.string_filter(a),d.options.allow_partial_matches===!0?(d.results=c.shallowCopy(this.data_filtered),a.split(" ").forEach(function(a){d.results=e.find(a,d.results,b)})):this.results=e.find(a,this.data_filtered,b),this},this.sort_results_by=function(a){if("function"==typeof a)this.results.sort(a);else{if(a===!1||d.options.default_sort===!1&&""===a)return this;if(""===a){var b=d.options.default_sort(this.results);Array.isArray(b)&&(this.results=b)}else a=d.options.string_filter(a),this.results=e.sort_by_match(this.results,a)}return this},this.search=function(a){return this.find(a).sort_results_by(a),this},this.all=function(a,b){return this.results=c.shallowCopy(a?this.data:this.data_filtered),this.sort_results_by("undefined"==typeof b?"":b),this},this.filter=function(a,b){return"function"==typeof a?this.results=this.data_filtered=e.findByFunction(a,this.data_filtered):("undefined"==typeof b&&(a=d.options.string_filter(a)),this.results=this.data_filtered=e.find(a,this.data_filtered,b)),this},this.clear_filters=function(){return this.data_filtered=c.shallowCopy(this.data),this},this.add=function(a){if(a instanceof Array){for(var b=0;b<a.length;b++)this.add(a[b]);return this}var c="undefined"!=typeof d.options.search_on&&d.options.search_on;return this.data.push(e.pre_process(a,c)),this.data_filtered=this.data,this},this.get=function(){return this.results},e.pre_process=function(a,b){var c="";return"string"==typeof a.__searchvalues&&"string"==typeof a.__keyvalue?a:(c=e.findSearchValues(a,b),a.__searchvalues=d.options.string_filter(c),a.__keyvalue=e.get_item_key(a),a)},e.findSearchValues=function(a,b){var d,f="";if(b){for(d in b)f+=" "+c.extractValue(a,b[d]);return f}for(d in a)a.hasOwnProperty(d)&&("object"==typeof a[d]&&(f+=" "+e.findSearchValues(a[d])),"string"!=typeof a[d]&&"number"!=typeof a[d]||(f+=" "+a[d]));return f},e.find=function(a,b,c){var d,e=0,f=[];for("undefined"==typeof c&&(c="__searchvalues"),e=0;e<b.length;e++)d=b[e],d[c].indexOf(a)!==-1&&f.push(d);return f},e.findByFunction=function(a,b){var c,d=0,e=[];for(d=0;d<b.length;d++)c=b[d],a(c)&&e.push(c);return e},e.sort_by_match=function(a,b){for(var c="undefined"==typeof d.options.gen_score?e.calculate_match_score:d.options.gen_score,f=0;f<a.length;f++)a[f].__score=c(a[f],b),a[f].__len_diff=Math.abs(b.length-a[f].__keyvalue.length);return a.sort(function(a,b){return a.__score===b.__score?a.__len_diff===b.__len_diff?a.__searchvalues>b.__searchvalues?1:-1:a.__len_diff>b.__len_diff?1:-1:a.__score<b.__score?1:-1}),a},e.default_sort=function(a){return a.sort(function(a,b){return a.__keyvalue>b.__keyvalue?1:-1})},e.calculate_match_score=function(a,b){var e,f=0;return e=a.__keyvalue.indexOf(b),!d.options.disable_occurrence_weighting&&b.length>2&&(f+=c.occurrences(a.__searchvalues,b)),f+=a.__searchvalues.indexOf(" "+b)!==-1?5:0,f+=e!==-1?10:0,f+=0===e?25:0,f+=0===e&&a.__keyvalue.length===b.length?10:0},e.simplfy_strings=function(a){return"string"!=typeof a&&(a=c.isPrimitive(a)?String(a):""),a=a.toLowerCase(),a=a.replace(/\&/g,"and"),a.replace(/[^a-z 0-9]/g,"").replace(/\s+/g," ").trim()},this.options={string_filter:e.simplfy_strings,disable_occurrence_weighting:!1,allow_partial_matches:!0},e.get_item_key=function(a){return d.options.string_filter(c.extractValue(a,d.options.key_value))},e.create(a,b)};b.create=function(a,c){return new b(a,c)};var c={};c.ajaxGetJSON=function(a,b){var c=null;try{c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}catch(d){console.log("[Quickspot] Unable to create XMLHttpRequest. Can not load data.")}"undefined"==typeof a.error&&(a.error=function(a){console.log("[Quickspot] AJAX request failed with error "+a)}),c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){try{var d=JSON.parse(c.responseText)}catch(e){return a.error("0",c.responseText)}b(d)}else a.error(c.status,c.responseText)},c.open("GET",a.url,!0),"undefined"!=typeof a.prevent_headers&&a.prevent_headers!==!1||c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.send(null)},c.addListener=function(a,b,c){window.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},c.removeListener=function(a,b,c){window.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},c.triggerEvent=function(a,b,c){if(document.createEvent){var d=document.createEvent("HTMLEvents");d.initEvent(b,!0,!0),"undefined"!=typeof c&&(d.quickspot=c),a.dispatchEvent(d)}},c.addClass=function(a,b){"undefined"!=typeof a&&null!==a&&(c.hasClass(a,b)||(a.className=(a.className+" "+b).trim()))},c.removeClass=function(a,b){"undefined"!=typeof a&&null!==a&&(a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(\\s|$)"),"").trim())},c.hasClass=function(a,b){if("undefined"!=typeof a&&null!==a)return null!==a.className.match(new RegExp("(^|\\s)"+b+"(\\s|$)"))},c.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},c.extractValue=function(a,b){var c,d;if(!b.indexOf("."))return a[b];d=b.split("."),c=a;for(var e=0;e<d.length&&"object"==typeof c&&null!==c;e++)c=c[d[e]];return"string"==typeof c||"number"==typeof c?c:""},c.isPrimitive=function(a){if(null===a)return!1;switch(typeof a){case"object":case"undefined":case"function":return!1}return!0},c.occurrences=function(a,b){if(a+="",b+="",b.length<=0)return a.length+1;for(var c=0,d=0,e=b.length;;){if(d=a.indexOf(b,d),!(d>=0))break;c++,d+=e}return c},c.shallowCopy=function(a){return Array.prototype.slice.call(a)};var d={};d.attach=function(b){var c=new a;return c.attach(b),c},d.datastore=function(a){if("undefined"!=typeof a.url){var d={store:null};return c.ajaxGetJSON(a,function(c){d.store=b.create(c,a),"undefined"!=typeof a.loaded&&a.loaded(d.store),"undefined"!=typeof d.__loaded&&d.__loaded(d.store)}),d}if("undefined"!=typeof a.data){var e=b.create(a.data,a);return"undefined"!=typeof a.loaded&&a.loaded(e),{store:e}}return!1},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=d:"function"==typeof define&&define.amd?define([],function(){return d}):window.quickspot=d}.call({}),"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)c in this&&a.call(b,this[c],c,this)}),!function(){"use strict";var a=Array.prototype.slice;try{a.call(document.documentElement)}catch(b){Array.prototype.slice=function(b,c){if(c=void 0!==c?c:this.length,"[object Array]"===Object.prototype.toString.call(this))return a.call(this,b,c);var d,e,f=[],g=this.length,h=b||0;h=h>=0?h:Math.max(0,g+h);var i="number"==typeof c?Math.min(c,g):g;if(c<0&&(i=g+c),(e=i-h)>0)if(f=new Array(e),this.charAt)for(d=0;d<e;d++)f[d]=this.charAt(h+d);else for(d=0;d<e;d++)f[d]=this[h+d];return f}}}(),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),"undefined"==typeof JSON){var json2=document.createElement("script");json2.src="//ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js",document.getElementsByTagName("head")[0].appendChild(json2)}"undefined"==typeof window.console&&(window.console={log:function(a){}});